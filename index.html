<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Diwali - Dazzling Wish 🪔</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* Apply custom font and ensure full screen coverage */
        body {
            font-family: 'Inter', sans-serif;
            /* Animated Gradient Background for maximum visual attraction */
            background: linear-gradient(-45deg, #0d0d1a, #2c0a42, #3a0026, #0d0d1a);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            overflow: hidden;
            cursor: pointer;
        }

        /* Keyframes for the body background animation */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Canvas for Fireworks */
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        /* Glowing text effect for the main message */
        .glowing-text {
            color: #FFD700; /* Gold */
            text-shadow: 0 0 10px #FF8C00, /* Dark orange glow */
                                0 0 20px #FF4500, /* Red-orange glow */
                                0 0 30px #FFD700; /* Light gold halo */
        }

        /* Floating card animation (the "pop" effect) */
        @keyframes float-in {
            0% { transform: scale(0.8) translateY(50px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        /* Pulse and Flip animation for interactive feedback */
        @keyframes pulse-card {
            0% { transform: scale(1) rotateY(0deg); }
            50% { transform: scale(1.02) rotateY(5deg); }
            100% { transform: scale(1) rotateY(0deg); }
        }

        .wish-card {
            animation: float-in 1.5s ease-out;
            box-shadow: 0 10px 30px rgba(255, 140, 0, 0.4), 0 0 50px rgba(255, 69, 0, 0.2);
            transition: transform 0.3s ease;
            position: relative; 
            transform-style: preserve-3d;
        }

        .wish-card:hover {
            transform: scale(1.03);
        }
        
        /* Applied when tapped */
        .card-pulse {
            animation: pulse-card 0.3s ease-in-out;
        }

        /* Ambient glowing dots for 'Diyas' effect */
        .ambient-light {
            width: 15px;
            height: 15px;
            background-color: #FF8C00;
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 8px 4px #FFD700, 0 0 15px 7px #FF4500;
            animation: pulse-glow 3s infinite alternate ease-in-out;
        }

        /* Custom animation for the ambient light pulse */
        @keyframes pulse-glow {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }

        /* Responsive adjustments for the card size */
        @media (max-width: 640px) {
            .wish-card {
                max-width: 90%;
            }
            .wish-title {
                font-size: 2.5rem;
            }
            .wish-message {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <canvas id="fireworks-canvas"></canvas>

    <div class="fixed inset-0 flex items-center justify-center p-4 z-10">
        <div id="wish-card" class="wish-card bg-white/10 backdrop-blur-sm border border-orange-500/50 rounded-xl p-8 md:p-12 text-center max-w-lg w-full">

            <div class="ambient-light top-[-20px] left-[-20px]"></div>
            <div class="ambient-light bottom-[-20px] right-[-20px]" style="animation-delay: 1s;"></div>
            <div class="ambient-light top-[-20px] right-[-20px]" style="animation-delay: 2s;"></div>
            <div class="ambient-light bottom-[-20px] left-[-20px]" style="animation-delay: 0.5s;"></div>

            <h1 id="wish-title" class="wish-title text-4xl md:text-6xl font-extrabold mb-4 glowing-text">
            </h1>
            <p id="wish-message-text" class="wish-message text-xl md:text-2xl text-amber-300 mb-6">
            </p>

            <div class="space-y-4">
                <p class="text-sm text-gray-200">
                    Tap the card to change the message and launch a spectacular firecracker!
                </p>
                <div class="flex justify-center space-x-4">
                    <span class="text-2xl animate-pulse">✨</span>
                    <span class="text-2xl animate-bounce" style="animation-delay: 0.1s;">🧡</span>
                    <span class="text-2xl animate-pulse" style="animation-delay: 0.2s;">🪔</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Start of IIFE: Isolates all script variables from the global scope
        (function() {
            // Placeholder/unused variables from original prompt
            // const apiKey = ""; 
            // const apiUrl = ""; 

            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');

            let W, H; 
            let stars = [];
            let isFirstTap = true;
            let isProcessingClick = false; // Debounce flag

            // --- Tone.js Setup for Sound Effects ---
            let amazingSynth, funnySynth, learningSynth;
            let launchSynth; 
            let explosionSynth; 
            
            function initializeAudio() {
                if (isFirstTap) {
                    Tone.start(); 
                    
                    // FX Chain
                    const reverb = new Tone.Reverb({ decay: 1.5, wet: 0.2 }).toDestination();
                    const delay = new Tone.PingPongDelay({ delayTime: "8n", feedback: 0.3, wet: 0.1 }).connect(reverb);
                    
                    // 1. Amazing Click Sound (Chime/Bell)
                    amazingSynth = new Tone.PolySynth(Tone.DuoSynth, {
                        vibratoAmount: 0.5,
                        vibratoRate: 5,
                        harmonicity: 1.5,
                        voice0: { volume: -10, oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0.0, release: 0.5 } },
                        voice1: { volume: -10, oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.5, sustain: 0.0, release: 0.5 } }
                    }).connect(delay);

                    // 2. Hindi/Funny Click Sound (Pluck/Boing)
                    funnySynth = new Tone.PluckSynth({
                        attackNoise: 0.8,
                        dampening: 2000,
                        resonance: 0.9
                    }).toDestination();
                    
                    // 3. Learning Click Sound (Subtle Sine)
                    learningSynth = new Tone.Synth({
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.05, decay: 0.2, sustain: 0.0, release: 0.3 }
                    }).toDestination();

                    // 4. Firework Launch Sound (Whoosh)
                    launchSynth = new Tone.NoiseSynth({
                        noise: { type: 'brown' },
                        envelope: { attack: 0.01, decay: 0.5, sustain: 0.01, release: 0.5 }
                    }).toDestination();
                    
                    // 5. **DIWALI FIRECRACKER MODIFICATION**: Explosion Sound (Sizzle/Crackling)
                    explosionSynth = new Tone.NoiseSynth({
                        noise: { type: 'white' },
                        envelope: { 
                            attack: 0.005, 
                            decay: 0.8, // Longer decay for sizzle
                            sustain: 0.0, 
                            release: 0.8 // Longer release for sizzle
                        }
                    }).toDestination();
                    
                    isFirstTap = false;
                }
            }
            
            // Centralized function to play the sound based on the current category
            function playCategorySound(category, time) {
                if (category === 'amazing' && amazingSynth) {
                    amazingSynth.triggerAttackRelease(['C6', 'E6', 'G6'], '8n', time); 
                } else if (category === 'hindi' && funnySynth) { // Using 'funnySynth' for Hindi/Funny category
                    funnySynth.triggerAttackRelease('D5', time);
                } else if (category === 'learning' && learningSynth) {
                    learningSynth.triggerAttackRelease('A4', '16n', time, 0.5); 
                }
            }


            // --- Utility Functions (Kept as is) ---
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            function getColor() {
                const colors = ['#FFD700', '#FF8C00', '#FF4500', '#FFA07A', '#F0E68C', '#FFFFE0', '#FF6347', '#00FFFF', '#ADFF2F'];
                return colors[Math.floor(random(0, colors.length))];
            }

            // --- Star Field Logic (Kept as is) ---
            function createStars() {
                stars = [];
                const starCount = W * H / 10000;
                for (let i = 0; i < starCount; i++) {
                    stars.push({
                        x: random(0, W),
                        y: random(0, H),
                        radius: random(0.5, 1.5),
                        alpha: random(0.3, 0.8)
                    });
                }
            }

            function drawStars() {
                ctx.fillStyle = '#FFFFFF';
                stars.forEach(star => {
                    ctx.save();
                    ctx.globalAlpha = star.alpha;
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2, false);
                    ctx.fill();
                    ctx.restore();
                });
            }


            // --- Particle Class for the Firecracker Trail and Explosion ---
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.color = color;
                    this.radius = random(1, 3);
                    this.alpha = 1;
                    this.friction = 0.98;
                    this.gravity = 0.4;
                    this.vx = random(-3, 3);
                    this.vy = random(-6, -4);
                    // **DIWALI FIRECRACKER MODIFICATION**: Renamed isShell to isRocket
                    this.isRocket = false; 
                }

                // **DIWALI FIRECRACKER MODIFICATION**: Renamed setShell to setRocket
                setRocket(targetY) {
                    this.isRocket = true;
                    this.vy = -(H * 0.005);
                    this.targetY = targetY;
                }

                update() {
                    // **DIWALI FIRECRACKER MODIFICATION**: Use isRocket
                    if (this.isRocket) { 
                        this.x += this.vx * 0.05;
                        this.y += this.vy;
                        if (this.y <= this.targetY) {
                            this.isRocket = false;
                            return true;
                        }
                    } else {
                        this.vy += this.gravity;
                        this.vx *= this.friction;
                        this.vy *= this.friction;
                        this.x += this.vx;
                        this.y += this.vy;
                        this.alpha -= 0.015;
                    }
                    return false;
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                    ctx.fill();
                    ctx.restore();
                }
            }

            // **DIWALI FIRECRACKER MODIFICATION**: Renamed array name
            let firecrackers = []; 
            let particles = [];

            // --- Firecracker Management ---
            // **DIWALI FIRECRACKER MODIFICATION**: Renamed class
            class Firecracker { 
                constructor(startX, startY, endX, endY) {
                    this.color = getColor();
                    // **DIWALI FIRECRACKER MODIFICATION**: Renamed shell to rocket
                    this.rocket = new Particle(startX, startY, this.color); 
                    // **DIWALI FIRECRACKER MODIFICATION**: Renamed setShell to setRocket
                    this.rocket.setRocket(endY); 
                    this.exploded = false;
                }

                update() {
                    if (!this.exploded) {
                        // **DIWALI FIRECRACKER MODIFICATION**: Update rocket
                        if (this.rocket.update()) { 
                            this.explode();
                            this.exploded = true;
                        }
                        // **DIWALI FIRECRACKER MODIFICATION**: Draw rocket
                        this.rocket.draw(); 
                    }
                }

                explode() {
                    if (explosionSynth) {
                        explosionSynth.triggerAttackRelease(0.2, Tone.now()); 
                    }

                    // **DIWALI FIRECRACKER MODIFICATION**: Reduced particle count (180 -> 80)
                    const particleCount = 80; 
                    for (let i = 0; i < particleCount; i++) {
                        // **DIWALI FIRECRACKER MODIFICATION**: Use rocket's position
                        const p = new Particle(this.rocket.x, this.rocket.y, this.color); 
                        const angle = random(0, Math.PI * 2);
                        // **DIWALI FIRECRACKER MODIFICATION**: Reduced max speed (12 -> 6) for a gentler cascade
                        const speed = random(1, 6); 
                        p.vx = Math.cos(angle) * speed;
                        p.vy = Math.sin(angle) * speed;
                        particles.push(p);
                    }
                }
            }

            // --- Initialization and Animation Loop ---
            function setupCanvas() {
                W = window.innerWidth;
                H = window.innerHeight;
                canvas.width = W;
                canvas.height = H;
                createStars();
            }

            window.addEventListener('resize', setupCanvas);

            // **DIWALI FIRECRACKER MODIFICATION**: Renamed function
            function createNewFirecracker(launchTime, isAuto = false) { 
                if (typeof W === 'undefined' || typeof H === 'undefined' || !launchSynth) return; 

                // **DIWALI FIRECRACKER MODIFICATION**: Set peak lower for ground-level feel
                const peakY = isAuto ? random(H * 0.6, H * 0.9) : random(H * 0.5, H * 0.8); 
                const startX = random(W * 0.1, W * 0.9);
                const startY = H;
                const endX = startX + random(-50, 50); // Smaller horizontal drift

                launchSynth.triggerAttackRelease(0.3, launchTime); 

                // **DIWALI FIRECRACKER MODIFICATION**: Push new Firecracker
                firecrackers.push(new Firecracker(startX, startY, endX, peakY));
            }
            
            // **DIWALI FIRECRACKER MODIFICATION**: Renamed function
            function launchAutomaticFirecracker() { 
                if (!isFirstTap) {
                    createNewFirecracker(Tone.now() + 0.1, true); 
                }
            }

            let autoFireworkInterval;

            function animate() {
                requestAnimationFrame(animate);

                // 1. Draw Star Field (static background)
                drawStars();
                
                // 2. Fading Trail Effect
                ctx.fillStyle = 'rgba(13, 13, 26, 0.1)';
                ctx.fillRect(0, 0, W, H);

                // 3. Update and draw firecrackers (rockets)
                // **DIWALI FIRECRACKER MODIFICATION**: Use firecrackers array
                firecrackers = firecrackers.filter(firecracker => !firecracker.exploded); 
                // **DIWALI FIRECRACKER MODIFICATION**: Iterate through firecrackers
                firecrackers.forEach(firecracker => firecracker.update()); 

                // 4. Update and draw particles (explosions)
                particles = particles.filter(particle => particle.alpha > 0);
                particles.forEach(particle => particle.update());
                particles.forEach(particle => particle.draw());
            }

            // --- Message Data and Cycling Logic (UPDATED with image text) ---
            const messages = {
                amazing: {
                    title: '✨Wishes for You! ✨',
                    quotes: [
                        "May you overcome all the difficulties in your life. May this Diwali be prosperous for you.",
                        "Diwali is a symbol of hope for humankind. May it bring universal compassion, inner joy of peace, love and the awareness of unity to all. Happy Diwali!",
                        "May this Diwali light up new dreams, fresh hopes, and unknown paths of success and happiness. Stay blessed!",
                        "Let the radiance of Diwali guide you through every challenge and illuminate the path to a prosperous future. Happy Deepawali!",
                    ]
                },
                hindi: {
                    title: '🪔 आप को दीपावली की शुभकामनाएँ! 🪷',
                    quotes: [
                        "शुभ दीपावली! आप सभी को दीपावली के पावन पर्व की हार्दिक शुभकामनाएँ। ",
                        "दीयों का प्रकाश आपके जीवन को खुशियों से भर दे। शुभ दीपावली! ",
                        "यह दिवाली आपके जीवन में सुख, शांति, और समृद्धि लाए। आपको और आपके परिवार को शुभ दीपावली!",
                    ]
                },
                learning: {
                    title: '📖 The Meaning of Diwali 🪔',
                    quotes: [
                        "Diwali is the celebration of Lord Rama’s return to Ayodhya after defeating the demon king Ravana, symbolizing the victory of good over evil (Dharma over Adharma).",
                        "The light of the Diya (lamp) represents knowledge and enlightenment, dispelling the darkness of ignorance. Reflect on this inner wisdom today.",
                        "On Diwali, we primarily worship Goddess Lakshmi (prosperity) and Lord Ganesha (wisdom). May you be blessed with both in abundance.",
                    ]
                }
            };

            let currentCategoryIndex = 0;
            const categories = ['amazing', 'hindi', 'learning'];
            const cardElement = document.getElementById('wish-card');
            const messageElement = document.getElementById('wish-message-text');
            const titleElement = document.getElementById('wish-title');

            function updateMessage() {
                // 1. Debounce Check
                if (isProcessingClick) return;
                isProcessingClick = true;
                
                // Start the background firecracker interval on the first click
                if (isFirstTap && !autoFireworkInterval) {
                    // **DIWALI FIRECRACKER MODIFICATION**: Use new function name
                    autoFireworkInterval = setInterval(launchAutomaticFirecracker, 2500); 
                }

                // Release the debounce lock after 250ms
                setTimeout(() => {
                    isProcessingClick = false;
                }, 250);

                // 2. Sound & Visual Feedback
                initializeAudio(); 
                
                const now = Tone.now();
                const currentCategory = categories[currentCategoryIndex];

                // Schedule category sound immediately
                playCategorySound(currentCategory, now);
                
                // Schedule the firecracker launch slightly after the click sound
                // **DIWALI FIRECRACKER MODIFICATION**: Call new function name
                createNewFirecracker(now + 0.2); 

                // Apply pulse class for visual pop and flip feedback
                cardElement.classList.add('card-pulse');
                setTimeout(() => {
                    cardElement.classList.remove('card-pulse');
                }, 300);


                // 3. Update Content
                
                // Apply the new title and a random quote from the current category
                titleElement.textContent = messages[currentCategory].title;
                messageElement.textContent = getRandomQuote(currentCategory);

                // Cycle to the next category for the next click
                currentCategoryIndex = (currentCategoryIndex + 1) % categories.length;
            }

            function getRandomQuote(category) {
                const list = messages[category].quotes;
                return list[Math.floor(Math.random() * list.length)];
            }


            // Initial load and interactivity setup
            window.onload = function () {
                setupCanvas();
                animate();
                updateMessage(); // Set initial message and category

                // Add interactivity to the card
                cardElement.addEventListener('click', updateMessage);
            }
        })();
    </script>

</body>
</html>